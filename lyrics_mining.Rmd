---
title: "lyrics_mining"
author: "CMF"
date: "2024-03-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list = ls())

library(readr)
library(tidyverse)
library(lubridate)
library(tidytext)
library(ggplot2)

```

```{r}
bts_lyrics <- read_csv("archive/lyrics-v12.csv")
bts_lyrics
```


```{r}
bts_lyrics <- bts_lyrics %>% 
  mutate(year = year(album_rd)) %>% 
  select(c(eng_album_title, year, album_seq, eng_track_title, lyrics)) %>%
  na.omit()
  
  

bts_lyrics
```

```{r}
bts_lyrics$lyrics <- iconv(bts_lyrics$lyrics, from = "", to = "UTF-8", sub = " ") # para corregir el error, 

bts_lyrics_rows <- bts_lyrics %>%
  separate_rows(lyrics, sep = "\n") %>%
  group_by(eng_track_title) %>%
  mutate(line_number = row_number()) %>%
  ungroup() %>% 
  mutate(lyrics = gsub("’", "'", lyrics)) # he visto que había un caracter diferente en lyrics y en las stop words que no permitía quitarlas bien, con esto se corrige

bts_lyrics_rows
```

```{r}
# tokenizing
tidy_bts_lyrics <- bts_lyrics_rows %>%
  unnest_tokens(word, lyrics)

tidy_bts_lyrics
```

```{r}
# Filtering stopwords
tidy_bts_lyrics <- tidy_bts_lyrics %>%
  anti_join(stop_words)

tidy_bts_lyrics
```
```{r}
# Counting word frequencies
tidy_bts_lyrics %>%
  count(word, sort = TRUE) 
```
```{r}
tidy_bts_lyrics %>%
  count(word, sort = TRUE) %>%
  #only words mentioned over 800 times in the novels
  filter(n > 300) %>%
  #we reorder words by number of mentions
  mutate(word = reorder(word, n)) %>%
  #we create the plot with the word (x) and the number of mentions (y)
  ggplot(aes(n, word)) +
  geom_col() +
  labs(y = NULL)
```

